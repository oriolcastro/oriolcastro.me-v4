---
import '../styles/global.css'

import { ClientRouter } from 'astro:transitions'

import BaseHead from '@/components/BaseHead.astro'
import SkipLink from '@/components/SkipLink.astro'
import ThemeProvider from '@/components/ThemeProvider.astro'
import Footer from '@/components/layout/Footer.astro'
import Header from '@/components/layout/Header.astro'
import { siteConfig } from '@/site.config'
import type { SiteMeta } from '@/types'

interface Props {
  meta: SiteMeta
}

const {
  meta: { title, description = siteConfig.description, ogImage, articleDate },
} = Astro.props
---

<html class="scroll-smooth" lang={siteConfig.lang}>
  <head>
    <BaseHead title={title} description={description} ogImage={ogImage} articleDate={articleDate} />
    <ClientRouter />
    <script is:inline>
      // Speculation Rules API - progressive enhancement
      if (HTMLScriptElement.supports && HTMLScriptElement.supports('speculationrules')) {
        const script = document.createElement('script')
        script.type = 'speculationrules'
        script.textContent = JSON.stringify({
          prerender: [
            {
              source: 'list',
              urls: Array.from(document.querySelectorAll('a[href]'))
                .map(a => a.href)
                .filter(href => {
                  try {
                    const url = new URL(href, window.location.href)
                    return url.origin === window.location.origin
                  } catch {
                    return false
                  }
                }),
            },
          ],
        })
        document.head.appendChild(script)
      }
    </script>
  </head>
  <body
    class="bg-bgColor text-textColor mx-auto flex min-h-screen max-w-3xl flex-col px-4 pt-16 font-mono text-sm font-normal antialiased sm:px-8"
  >
    <ThemeProvider />
    <SkipLink />
    <Header />
    <main id="main">
      <slot />
    </main>
    <Footer />
  </body>
</html>
